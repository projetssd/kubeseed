---
### CLOUDFLARE IPv4 ###
- name: Set DNS Record IPv4 in CF
  cloudflare_dns:
    account_api_token: "{{ cloudflare.api }}"
    account_email: "{{ cloudflare.login }}"
    zone: "{{ user.domain }}"
    state: present
    solo: true
    proxied: true
    type: A
    value: "{{ network.ipv4 }}"
    record: "{{ subdomain }}"
  when: cloudflare.usage == "O"

### PDNS/NSUPDATE IPv4 ###
- name: Set DNS Record IPv4 in NSUP
  community.general.nsupdate:
    key_algorithm: "{{ dns.algo }}"
    key_name: "{{ dns.keyname }}"
    key_secret: "{{ dns.keysecret }}"
    server: "{{ dns.server }}"
    zone: "{{ user.domain }}"
    record: "{{ subdomain }}"
    value: "{{ network.ipv4 }}"
    ttl: "86400"
    type: "A"
  when: dns.usage == "O"

### CLOUDFLARE IPv6 ###
- name: Set DNS Record IPv6 in CF
  cloudflare_dns:
    account_api_token: "{{ cloudflare.api }}"
    account_email: "{{ cloudflare.login }}"
    zone: "{{ user.domain }}"
    state: present
    solo: true
    proxied: true
    type: AAAA
    value: "{{ network.ipv6 }}"
    record: "{{ subdomain }}"
  when: cloudflare.usage == "O" and network.ipv6 != 'YAPAS'

### PDNS/NSUPDATE IPv6 ###
- name: Set DNS Record IPv6 in NSUP
  community.general.nsupdate:
    key_algorithm: "{{ dns.algo }}"
    key_name: "{{ dns.keyname }}"
    key_secret: "{{ dns.keysecret }}"
    server: "{{ dns.server }}"
    zone: "{{ user.domain }}"
    record: "{{ subdomain }}"
    value: "{{ network.ipv6 }}"
    ttl: "86400"
    type: "AAAA"
  when: dns.usage == "O" and network.ipv6 != 'YAPAS'
